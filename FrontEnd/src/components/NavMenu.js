import { jsx as _jsx, jsxs as _jsxs } from "react/jsx-runtime";
import React, { useRef, useEffect } from 'react';
import { motion, AnimatePresence } from 'framer-motion';
import { Menu, X, Search, User } from 'lucide-react'; // Icons
import { MenuItem } from '../types/menu'; // See types below
import { useNavMenu } from '../hooks/useNavMenu';
const NavMenu = React.memo(({ items, user, onSearch, loading = false }) => {
    const { isOpen, toggleMenu, closeMenu } = useNavMenu();
    const navRef = useRef(null);
    // Outside click detection
    useEffect(() => {
        const handleClickOutside = (event) => {
            if (navRef.current && !navRef.current.contains(event.target)) {
                closeMenu();
            }
        };
        if (isOpen)
            document.addEventListener('mousedown', handleClickOutside);
        return () => document.removeEventListener('mousedown', handleClickOutside);
    }, [isOpen, closeMenu]);
    // Keyboard nav (focus management)
    useEffect(() => {
        if (isOpen && navRef.current) {
            navRef.current.querySelector('a')?.focus();
        }
    }, [isOpen]);
    return (_jsxs("nav", { ref: navRef, role: "navigation", "aria-label": "Main navigation", className: "bg-white dark:bg-gray-800 shadow-md border-b border-gray-200 dark:border-gray-700", children: [_jsxs("div", { className: "hidden md:flex items-center justify-between px-4 py-3 max-w-7xl mx-auto", children: [_jsx("div", { className: "flex items-center space-x-8", children: items.map((item) => (_jsxs("div", { className: "relative", children: [_jsxs("button", { className: "flex items-center space-x-1 text-gray-700 dark:text-gray-300 hover:text-blue-600 transition-colors", onClick: () => { }, "aria-haspopup": "true", "aria-expanded": false, children: [item.icon ? React.createElement(item.icon, { size: 20 }) : null, _jsx("span", { children: item.label }), item.children && _jsx(ChevronDown, { className: "ml-1 h-4 w-4" })] }), _jsx(AnimatePresence, { children: item.children && (_jsx(motion.ul, { initial: { opacity: 0, y: -10 }, animate: { opacity: 1, y: 0 }, exit: { opacity: 0, y: -10 }, className: "absolute left-0 mt-2 bg-white dark:bg-gray-800 rounded-md shadow-lg py-2 w-48 z-50 border border-gray-200 dark:border-gray-700", children: item.children.map((child) => (_jsx("li", { children: _jsx("a", { href: child.href, className: "block px-4 py-2 text-sm text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors", onClick: closeMenu, children: child.label }) }, child.label))) })) })] }, item.label))) }), _jsxs("div", { className: "flex items-center space-x-4", children: [_jsxs("div", { className: "relative", children: [_jsx(Search, { size: 20, className: "absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400" }), _jsx("input", { type: "text", placeholder: "Search workflows...", className: "pl-10 pr-4 py-2 border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700 text-gray-900 dark:text-white w-64 focus:outline-none focus:ring-2 focus:ring-blue-500", onChange: (e) => onSearch?.(e.target.value), disabled: loading }), loading && _jsx("div", { className: "absolute right-3 top-1/2 transform -translate-y-1/2 w-4 h-4 border-2 border-blue-500 border-t-transparent rounded-full animate-spin" })] }), user && (_jsxs("div", { className: "relative", children: [_jsxs("button", { className: "flex items-center space-x-2 text-gray-700 dark:text-gray-300 hover:text-blue-600", children: [user.avatar ? (_jsx("img", { src: user.avatar, alt: user.name, className: "w-8 h-8 rounded-full" })) : (_jsx(User, { size: 20 })), _jsx("span", { className: "hidden sm:inline", children: user.name })] }), _jsxs(motion.div, { initial: { opacity: 0, scale: 0.95 }, animate: { opacity: 1, scale: 1 }, className: "absolute right-0 mt-2 bg-white dark:bg-gray-800 rounded-md shadow-lg py-2 w-48 z-50", children: [_jsx("a", { href: "/profile", className: "block px-4 py-2 text-sm text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700", children: "Profile" }), _jsx("a", { href: "/logout", className: "block px-4 py-2 text-sm text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700", children: "Logout" })] })] }))] })] }), _jsxs("div", { className: "md:hidden flex items-center justify-between px-4 py-3", children: [_jsx("button", { onClick: toggleMenu, className: "md:hidden p-2 rounded-md text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700", children: isOpen ? _jsx(X, { size: 24 }) : _jsx(Menu, { size: 24 }) }), _jsxs("div", { className: "flex-1 mx-4 relative", children: [_jsx("input", { type: "text", placeholder: "Search...", className: "w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:outline-none focus:ring-2 focus:ring-blue-500", onChange: (e) => onSearch?.(e.target.value), disabled: loading }), loading && _jsx("div", { className: "absolute right-4 top-1/2 transform -translate-y-1/2 w-4 h-4 border-2 border-blue-500 border-t-transparent rounded-full animate-spin" })] }), user && (_jsx("div", { className: "flex items-center space-x-2", children: user.avatar ? _jsx("img", { src: user.avatar, alt: user.name, className: "w-8 h-8 rounded-full" }) : _jsx(User, { size: 20 }) }))] }), _jsx(AnimatePresence, { children: isOpen && (_jsx(motion.div, { initial: { height: 0, opacity: 0 }, animate: { height: 'auto', opacity: 1 }, exit: { height: 0, opacity: 0 }, className: "md:hidden overflow-hidden", children: _jsx("ul", { className: "bg-white dark:bg-gray-800 border-t border-gray-200 dark:border-gray-700", children: items.map((item) => (_jsx("li", { className: "border-b border-gray-100 dark:border-gray-700", children: _jsxs("details", { className: "p-4", children: [_jsxs("summary", { className: "flex items-center space-x-2 cursor-pointer text-gray-700 dark:text-gray-300 hover:text-blue-600", children: [item.icon ? React.createElement(item.icon, { size: 20 }) : null, _jsx("span", { children: item.label })] }), item.children && (_jsx("ul", { className: "mt-2 ml-6 space-y-1", children: item.children.map((child) => (_jsx("li", { children: _jsx("a", { href: child.href, className: "block py-1 text-sm text-gray-600 dark:text-gray-400 hover:text-blue-600", onClick: closeMenu, children: child.label }) }, child.label))) }))] }) }, item.label))) }) })) })] }));
});
const ChevronDown = ({ className }) => (_jsx("svg", { className: className, fill: "none", stroke: "currentColor", viewBox: "0 0 24 24", children: _jsx("path", { strokeLinecap: "round", strokeLinejoin: "round", strokeWidth: 2, d: "M19 9l-7 7-7-7" }) }));
export default NavMenu;
//# sourceMappingURL=NavMenu.js.map